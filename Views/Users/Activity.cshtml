@{
    ViewData["Title"] = "Login Activity";
}

<div class="page-header">
    <h1 class="page-title">Login Activity</h1>
    <p class="page-subtitle">Monitor user login history and security events</p>
</div>

<div class="card fade-in">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Recent Activity</h5>
        <span class="badge bg-primary" id="activityCount">0 entries</span>
    </div>
    <div class="card-body" style="padding: 0;">
        <table class="data-table" id="activityTable">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Date & Time</th>
                    <th>Role</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="activityTableBody">
                <!-- Dynamic content loaded from users -->
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
<script src="~/js/admin.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async function() {
        await loadActivity();
    });

    async function loadActivity() {
        try {
            const users = await API.get('/users');
            const tbody = document.getElementById('activityTableBody');
            
            // Generate mock activity based on users (since we don't have a real activity log table)
            const activities = [];
            users.forEach(u => {
                if (u.lastLoginDate) {
                    activities.push({
                        user: u.firstName + ' ' + u.lastName,
                        date: new Date(u.lastLoginDate),
                        role: u.role || 'User',
                        status: 'Success'
                    });
                }
            });

            // Sort by date descending
            activities.sort((a, b) => b.date - a.date);
            
            document.getElementById('activityCount').textContent = activities.length + ' entries';

            if (activities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-4">No login activity recorded</td></tr>';
                return;
            }

            tbody.innerHTML = activities.map(a => `
                <tr>
                    <td><strong>${a.user}</strong></td>
                    <td>${Format.date(a.date)} ${a.date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</td>
                    <td><span class="badge badge-info">${a.role}</span></td>
                    <td><span class="badge badge-success">${a.status}</span></td>
                </tr>
            `).join('');
        } catch (error) {
            console.error('Failed to load activity:', error);
            Toast.error('Failed to load login activity');
        }
    }
</script>
}
