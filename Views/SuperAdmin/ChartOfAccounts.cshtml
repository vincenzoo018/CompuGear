@{
    ViewData["Title"] = "Chart of Accounts";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
}

<div class="page-header">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
        <div>
            <p class="text-muted mb-0">Accounting</p>
            <h1 class="page-title">Chart of Accounts</h1>
            <p class="page-subtitle">Platform-level chart of accounts for subscription revenue, taxes, and operating expenses.</p>
        </div>
        <button class="btn btn-primary" onclick="COAModule.openCreate()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Account
        </button>
    </div>
</div>

<!-- Stats -->
<div class="stat-cards">
    <div class="stat-card fade-in stagger-1">
        <div class="stat-info"><span class="stat-label">Total Accounts</span><span class="stat-value" id="totalAccounts">0</span></div>
        <div class="stat-icon teal"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
    </div>
    <div class="stat-card fade-in stagger-2">
        <div class="stat-info"><span class="stat-label">Active Accounts</span><span class="stat-value" id="activeAccounts">0</span></div>
        <div class="stat-icon green"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>
    </div>
    <div class="stat-card fade-in stagger-3">
        <div class="stat-info"><span class="stat-label">Total Debits</span><span class="stat-value" id="totalDebits">₱0</span></div>
        <div class="stat-icon blue"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div>
    </div>
    <div class="stat-card fade-in stagger-4">
        <div class="stat-info"><span class="stat-label">Total Credits</span><span class="stat-value" id="totalCredits">₱0</span></div>
        <div class="stat-icon orange"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg></div>
    </div>
</div>

<!-- Filters -->
<div class="card fade-in mb-3 mt-3">
    <div class="card-body">
        <div class="d-flex gap-3 align-items-end flex-wrap">
            <div class="form-group mb-0 flex-grow-1">
                <label class="form-label">Search</label>
                <input type="text" class="form-control" id="coaSearch" placeholder="Search by code or name..." oninput="COAModule.currentPage=1;COAModule.render()">
            </div>
            <div class="form-group mb-0">
                <label class="form-label">Account Type</label>
                <select class="form-control" id="coaTypeFilter" onchange="COAModule.currentPage=1;COAModule.render()">
                    <option value="">All Types</option>
                    <option value="Asset">Asset</option>
                    <option value="Liability">Liability</option>
                    <option value="Equity">Equity</option>
                    <option value="Revenue">Revenue</option>
                    <option value="Expense">Expense</option>
                    <option value="Cost of Goods Sold">COGS</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Table -->
<div class="card fade-in">
    <div class="card-body" style="padding:0;">
        <div class="data-table-wrapper">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Account Name</th>
                        <th>Type</th>
                        <th class="text-center">Normal Balance</th>
                        <th class="text-end">Total Debit</th>
                        <th class="text-end">Total Credit</th>
                        <th class="text-end">Balance</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody id="coaTableBody">
                    <tr><td colspan="8" class="text-center py-4">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center" id="coaPagination"></div>
</div>

<!-- Create/Edit Account Modal -->
<div class="modal fade" id="coaModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header modal-header-primary">
                <h5 class="modal-title" id="coaModalTitle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    Add Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="coaId">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="form-group mb-0"><label class="form-label">Account Code *</label>
                        <input type="text" class="form-control" id="coaCode" placeholder="e.g. 1000"></div>
                    </div>
                    <div class="col-md-8">
                        <div class="form-group mb-0"><label class="form-label">Account Name *</label>
                        <input type="text" class="form-control" id="coaName" placeholder="e.g. Platform Cash"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-0"><label class="form-label">Account Type</label>
                        <select class="form-control" id="coaType">
                            <option value="Asset">Asset</option>
                            <option value="Liability">Liability</option>
                            <option value="Equity">Equity</option>
                            <option value="Revenue">Revenue</option>
                            <option value="Expense">Expense</option>
                            <option value="Cost of Goods Sold">Cost of Goods Sold</option>
                        </select></div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-0"><label class="form-label">Normal Balance</label>
                        <select class="form-control" id="coaNormal">
                            <option value="Debit">Debit</option>
                            <option value="Credit">Credit</option>
                        </select></div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-0"><label class="form-label">Parent Account ID</label>
                        <input type="number" class="form-control" id="coaParent" placeholder="Optional"></div>
                    </div>
                    <div class="col-md-6 d-flex align-items-end">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="coaActive" checked>
                            <label class="form-check-label" for="coaActive">Active</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="form-group mb-0"><label class="form-label">Description</label>
                        <textarea class="form-control" id="coaDesc" rows="2" placeholder="Account description..."></textarea></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="COAModule.save()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Save
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/superadmin-accounting.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => COAModule.load());
    </script>
}
