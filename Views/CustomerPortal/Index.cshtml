@{
    ViewData["Title"] = "My Dashboard";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<!-- Welcome Banner -->
<div class="promo-banner mb-4">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h2>üéÆ Welcome back, Maria!</h2>
            <p>Check out our latest computer accessories and exclusive deals just for you!</p>
            <a href="/CustomerPortal/Promotions" class="btn-shop">View Promotions</a>
        </div>
        <div class="col-lg-4 text-center d-none d-lg-block">
            <div style="font-size: 6rem;">üñ•Ô∏è</div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <div class="stat-value">12</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #008080, #20b2aa); color: white;">
                    üì¶
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <div class="stat-value">2</div>
                    <div class="stat-label">Pending Orders</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white;">
                    ‚è≥
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <div class="stat-value">1,250</div>
                    <div class="stat-label">Loyalty Points</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">
                    ‚≠ê
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex align-items-center justify-content-between">
                <div>
                    <div class="stat-value">1</div>
                    <div class="stat-label">Open Tickets</div>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #f87171); color: white;">
                    üé´
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="row g-4">
    <!-- Recent Orders -->
    <div class="col-lg-8">
        <div class="portal-card">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0" style="font-weight: 600; color: #1f2937;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#008080" stroke-width="2" style="margin-right: 10px; vertical-align: middle;">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
                    </svg>
                    Recent Orders
                </h5>
                <a href="/CustomerPortal/Orders" style="color: #008080; text-decoration: none; font-weight: 500;">View All ‚Üí</a>
            </div>
            
            <div class="table-responsive">
                <table class="table" style="margin-bottom: 0;">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th style="border: none; padding: 12px; color: #6b7280; font-weight: 600;">Order #</th>
                            <th style="border: none; padding: 12px; color: #6b7280; font-weight: 600;">Date</th>
                            <th style="border: none; padding: 12px; color: #6b7280; font-weight: 600;">Items</th>
                            <th style="border: none; padding: 12px; color: #6b7280; font-weight: 600;">Total</th>
                            <th style="border: none; padding: 12px; color: #6b7280; font-weight: 600;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">
                                <strong style="color: #008080;">ORD-2026-0089</strong>
                            </td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">Jan 30, 2026</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">Razer BlackWidow V4 Pro</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">‚Ç±11,000.00</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">
                                <span style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;">Processing</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">
                                <strong style="color: #008080;">ORD-2026-0082</strong>
                            </td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">Jan 28, 2026</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">Logitech G502 X Plus</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">‚Ç±6,500.00</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">
                                <span style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;">Shipped</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 15px;">
                                <strong style="color: #008080;">ORD-2026-0075</strong>
                            </td>
                            <td style="padding: 15px;">Jan 25, 2026</td>
                            <td style="padding: 15px;">Corsair Vengeance 32GB DDR5</td>
                            <td style="padding: 15px; font-weight: 600;">‚Ç±11,500.00</td>
                            <td style="padding: 15px;">
                                <span style="background: linear-gradient(135deg, #10b981, #34d399); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;">Delivered</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Quick Actions & Notifications -->
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="portal-card mb-4">
            <h5 class="mb-4" style="font-weight: 600; color: #1f2937;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#008080" stroke-width="2" style="margin-right: 10px; vertical-align: middle;">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                Quick Actions
            </h5>
            <div class="d-grid gap-3">
                <a href="/CustomerPortal/Products" class="btn" style="background: linear-gradient(135deg, #008080, #006666); color: white; padding: 12px; border-radius: 10px; text-decoration: none; display: flex; align-items: center; gap: 10px;">
                    üõí Browse Products
                </a>
                <a href="/CustomerPortal/SubmitTicket" class="btn" style="background: linear-gradient(135deg, #ff6b35, #ff8c42); color: white; padding: 12px; border-radius: 10px; text-decoration: none; display: flex; align-items: center; gap: 10px;">
                    üé´ Submit Support Ticket
                </a>
                <a href="/CustomerPortal/Support" class="btn" style="background: linear-gradient(135deg, #10b981, #34d399); color: white; padding: 12px; border-radius: 10px; text-decoration: none; display: flex; align-items: center; gap: 10px;">
                    üí¨ Chat with Support
                </a>
            </div>
        </div>

        <!-- Active Promotions -->
        <div class="portal-card">
            <h5 class="mb-4" style="font-weight: 600; color: #1f2937;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff6b35" stroke-width="2" style="margin-right: 10px; vertical-align: middle;">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                Active Promotions
            </h5>
            <div class="promo-item p-3 mb-3" style="background: linear-gradient(135deg, #fff5f0, #ffebe0); border-radius: 12px; border-left: 4px solid #ff6b35;">
                <div style="font-weight: 600; color: #ff6b35;">üî• Gaming Week Sale!</div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-top: 5px;">Up to 30% off on gaming peripherals</div>
                <div style="font-size: 0.75rem; color: #9ca3af; margin-top: 5px;">Valid until Feb 15, 2026</div>
            </div>
            <div class="promo-item p-3" style="background: linear-gradient(135deg, #f0fff4, #dcfce7); border-radius: 12px; border-left: 4px solid #10b981;">
                <div style="font-weight: 600; color: #10b981;">üéÅ Free Shipping</div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-top: 5px;">On orders over ‚Ç±5,000</div>
                <div style="font-size: 0.75rem; color: #9ca3af; margin-top: 5px;">Limited time offer</div>
            </div>
        </div>
    </div>
</div>

<!-- Featured Products -->
<div class="portal-card mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="mb-0" style="font-weight: 600; color: #1f2937;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff6b35" stroke-width="2" style="margin-right: 10px; vertical-align: middle;">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            Featured Products
        </h5>
        <a href="/CustomerPortal/Products" style="color: #008080; text-decoration: none; font-weight: 500;">View All ‚Üí</a>
    </div>
    
    <div class="row g-4" id="featuredProductsGrid">
        <div class="col-12 text-center py-4">
            <div class="spinner-border text-primary spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadFeaturedProducts();
    });

    async function loadFeaturedProducts() {
        try {
            const response = await fetch('/api/products');
            if (response.ok) {
                const products = await response.json();
                // Get featured or first 4 products with sale badge
                const featured = products.filter(p => p.isFeatured || p.isOnSale).slice(0, 4);
                const displayProducts = featured.length >= 4 ? featured : products.slice(0, 4);
                renderFeaturedProducts(displayProducts);
            } else {
                showFeaturedError();
            }
        } catch (error) {
            console.error('Error loading featured products:', error);
            showFeaturedError();
        }
    }

    function renderFeaturedProducts(products) {
        const grid = document.getElementById('featuredProductsGrid');
        
        if (products.length === 0) {
            grid.innerHTML = `
                <div class="col-12 text-center py-4 text-muted">
                    <p>No products available at the moment.</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = products.map(product => {
            const imageHtml = product.mainImageUrl 
                ? `<img src="${product.mainImageUrl}" alt="${product.productName}" class="product-img" onerror="this.parentElement.innerHTML='<div class=\\'product-image-placeholder\\'><svg width=\\'48\\' height=\\'48\\' viewBox=\\'0 0 24 24\\' fill=\\'none\\' stroke=\\'currentColor\\' stroke-width=\\'1.5\\'><rect x=\\'3\\' y=\\'3\\' width=\\'18\\' height=\\'18\\' rx=\\'2\\'/><circle cx=\\'8.5\\' cy=\\'8.5\\' r=\\'1.5\\'/><path d=\\'m21 15-5-5L5 21\\'/></svg></div>'">`
                : `<div class="product-image-placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="m21 15-5-5L5 21"/>
                    </svg>
                </div>`;

            const badge = product.isOnSale 
                ? '<span class="sale-badge">SALE</span>'
                : product.isFeatured 
                    ? '<span class="sale-badge" style="background: #f59e0b;">HOT</span>'
                    : '';

            const price = product.sellingPrice || product.costPrice || 0;
            const comparePrice = product.compareAtPrice && product.compareAtPrice > price 
                ? `<span class="original-price">‚Ç±${parseFloat(product.compareAtPrice).toLocaleString('en-PH')}</span>` 
                : '';

            return `
                <div class="col-md-3">
                    <div class="product-card">
                        <div class="product-image">
                            ${badge}
                            ${imageHtml}
                        </div>
                        <div class="product-info">
                            <div class="product-category">${product.categoryName || 'Uncategorized'}</div>
                            <div class="product-name">${product.productName}</div>
                            <div class="product-price">
                                <span class="current-price">‚Ç±${parseFloat(price).toLocaleString('en-PH')}</span>
                                ${comparePrice}
                            </div>
                            <button class="btn-add-cart" onclick="addToCart(${product.productId}, '${product.productName.replace(/'/g, "\\'")}', ${price})">Add to Cart</button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function showFeaturedError() {
        document.getElementById('featuredProductsGrid').innerHTML = `
            <div class="col-12 text-center py-4 text-muted">
                <p>Unable to load featured products.</p>
            </div>
        `;
    }

    function addToCart(productId, productName, price) {
        // TODO: Implement actual cart functionality
        alert(productName + ' has been added to your cart!');
    }
</script>
}