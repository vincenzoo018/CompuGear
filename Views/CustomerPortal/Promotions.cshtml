@{
    ViewData["Title"] = "Promotions & Deals";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<style>
    .promos-page { padding: 30px 0; background: #f8f9fa; min-height: 100vh; }
    
    .hero-banner {
        background: linear-gradient(135deg, #008080 0%, #20b2aa 50%, #ff6b35 100%);
        border-radius: 25px;
        padding: 60px 50px;
        color: white;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }
    
    .hero-banner::before {
        content: 'üéâ';
        position: absolute;
        right: 50px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 8rem;
        opacity: 0.3;
    }
    
    .hero-banner h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 15px;
    }
    
    .hero-banner p {
        font-size: 1.2rem;
        opacity: 0.9;
        max-width: 600px;
    }
    
    .section-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: #1f2937;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .promos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
    }
    
    .promo-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 4px 25px rgba(0,0,0,0.08);
        transition: all 0.3s;
    }
    
    .promo-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.15);
    }
    
    .promo-header {
        padding: 30px;
        color: white;
        position: relative;
    }
    
    .promo-header.percentage { background: linear-gradient(135deg, #ff6b35, #ff8c42); }
    .promo-header.fixed { background: linear-gradient(135deg, #10b981, #34d399); }
    .promo-header.bogo { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
    .promo-header.free-shipping { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
    
    .promo-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255,255,255,0.2);
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .promo-discount {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 5px;
    }
    
    .promo-name {
        font-size: 1.2rem;
        font-weight: 600;
        opacity: 0.95;
    }
    
    .promo-body { padding: 25px 30px; }
    
    .promo-description {
        color: #6b7280;
        margin-bottom: 20px;
        line-height: 1.6;
    }
    
    .promo-code-box {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f3f4f6;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
    }
    
    .promo-code-label { color: #6b7280; font-size: 0.85rem; }
    
    .promo-code {
        font-family: monospace;
        font-size: 1.2rem;
        font-weight: 700;
        color: #008080;
        letter-spacing: 2px;
    }
    
    .copy-btn {
        margin-left: auto;
        padding: 8px 15px;
        background: #008080;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
    }
    
    .copy-btn:hover { background: #006666; }
    
    .promo-validity {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #9ca3af;
        font-size: 0.85rem;
    }
    
    .promo-footer {
        padding: 20px 30px;
        border-top: 1px solid #f3f4f6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .min-purchase { color: #6b7280; font-size: 0.85rem; }
    
    .shop-btn {
        padding: 10px 25px;
        background: linear-gradient(135deg, #008080, #006666);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        text-decoration: none;
    }
    
    .shop-btn:hover {
        transform: translateY(-2px);
        color: white;
    }
    
    /* Campaigns Section */
    .campaigns-section { margin-top: 50px; }
    
    .campaign-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 4px 25px rgba(0,0,0,0.08);
        margin-bottom: 25px;
    }
    
    .campaign-banner {
        height: 200px;
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .campaign-banner-text {
        text-align: center;
        color: white;
        z-index: 1;
    }
    
    .campaign-banner-text h2 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 10px;
    }
    
    .campaign-banner-text p { opacity: 0.8; }
    
    .campaign-body { padding: 30px; }
    
    .campaign-meta {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #6b7280;
    }
    
    .meta-icon { font-size: 1.2rem; }
    
    .campaign-description {
        color: #4b5563;
        line-height: 1.8;
        margin-bottom: 25px;
    }
    
    .campaign-cta {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .cta-btn {
        padding: 14px 30px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
    }
    
    .cta-primary {
        background: linear-gradient(135deg, #008080, #006666);
        color: white;
        border: none;
    }
    
    .cta-secondary {
        background: white;
        color: #008080;
        border: 2px solid #008080;
    }
    
    .cta-btn:hover { transform: translateY(-3px); color: inherit; }
    .cta-primary:hover { color: white; }
    
    .empty-state {
        text-align: center;
        padding: 60px;
        background: white;
        border-radius: 20px;
    }
    
    .empty-state-icon { font-size: 5rem; margin-bottom: 20px; }
    .empty-state h3 { color: #1f2937; margin-bottom: 10px; }
    .empty-state p { color: #6b7280; }
    
    .countdown-timer {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }
    
    .countdown-item {
        text-align: center;
        background: rgba(255,255,255,0.2);
        padding: 10px 15px;
        border-radius: 10px;
    }
    
    .countdown-value {
        font-size: 1.5rem;
        font-weight: 800;
        display: block;
    }
    
    .countdown-label { font-size: 0.75rem; opacity: 0.8; }
</style>

<div class="promos-page">
    <div class="container">
        <div class="hero-banner">
            <h1>üî• Hot Deals & Promos</h1>
            <p>Don't miss out on our exclusive offers! Save big on computer accessories and gear.</p>
        </div>
        
        <!-- Active Promotions -->
        <h2 class="section-title">üè∑Ô∏è Active Promotions</h2>
        <div class="promos-grid" id="promotionsGrid">
            <div class="empty-state">
                <div class="empty-state-icon">‚è≥</div>
                <h3>Loading promotions...</h3>
            </div>
        </div>
        
        <!-- Marketing Campaigns -->
        <div class="campaigns-section">
            <h2 class="section-title">üì£ Marketing Campaigns</h2>
            <div id="campaignsContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">‚è≥</div>
                    <h3>Loading campaigns...</h3>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadPromotions();
    });

    async function loadPromotions() {
        try {
            const response = await fetch('/CustomerPortal/GetPromotions');
            const result = await response.json();
            
            if (result.success) {
                renderPromotions(result.data.promotions);
                renderCampaigns(result.data.campaigns);
            } else {
                renderEmpty();
            }
        } catch (error) {
            console.error('Error loading promotions:', error);
            renderEmpty();
        }
    }

    function renderPromotions(promotions) {
        const grid = document.getElementById('promotionsGrid');
        
        if (!promotions || promotions.length === 0) {
            grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1;">
                    <div class="empty-state-icon">üè∑Ô∏è</div>
                    <h3>No active promotions right now</h3>
                    <p>Check back later for amazing deals!</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = promotions.map(promo => {
            const headerClass = promo.discountType === 'Percentage' ? 'percentage' : 
                               promo.promotionName?.toLowerCase().includes('bogo') ? 'bogo' :
                               promo.promotionName?.toLowerCase().includes('shipping') ? 'free-shipping' : 'fixed';
            
            const discountDisplay = promo.discountType === 'Percentage' 
                ? `${promo.discountValue}% OFF`
                : promo.discountType === 'FreeShipping'
                    ? 'FREE SHIPPING'
                    : `‚Ç±${promo.discountValue} OFF`;
            
            const endDate = new Date(promo.endDate);
            const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));

            // Image display - use uploaded image or gradient fallback
            const headerStyle = promo.imageUrl 
                ? `background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.6)), url('${promo.imageUrl}'); background-size: cover; background-position: center; min-height: 180px;`
                : '';

            return `
                <div class="promo-card">
                    <div class="promo-header ${headerClass}" style="${headerStyle}">
                        <span class="promo-badge">${daysLeft > 0 ? `${daysLeft} days left` : 'Ending soon!'}</span>
                        <div class="promo-discount">${discountDisplay}</div>
                        <div class="promo-name">${promo.promotionName}</div>
                    </div>
                    <div class="promo-body">
                        <p class="promo-description">${promo.description || 'Get this amazing discount on selected items!'}</p>
                        <div class="promo-code-box">
                            <div>
                                <div class="promo-code-label">Use code:</div>
                                <div class="promo-code">${promo.promotionCode}</div>
                            </div>
                            <button class="copy-btn" onclick="copyCode('${promo.promotionCode}')">üìã Copy</button>
                        </div>
                        <div class="promo-validity">
                            <span>üìÖ</span>
                            <span>Valid until ${endDate.toLocaleDateString('en-PH', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
                        </div>
                    </div>
                    <div class="promo-footer">
                        ${promo.minOrderAmount > 0 
                            ? `<span class="min-purchase">Min. purchase: ‚Ç±${promo.minOrderAmount.toLocaleString()}</span>` 
                            : '<span class="min-purchase">No minimum purchase</span>'}
                        <a href="/CustomerPortal/Products" class="shop-btn">Shop Now ‚Üí</a>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderCampaigns(campaigns) {
        const container = document.getElementById('campaignsContainer');
        
        if (!campaigns || campaigns.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üì£</div>
                    <h3>No active campaigns</h3>
                    <p>Stay tuned for upcoming marketing events and campaigns!</p>
                </div>
            `;
            return;
        }

        container.innerHTML = campaigns.map(campaign => {
            const startDate = new Date(campaign.startDate);
            const endDate = new Date(campaign.endDate);
            
            return `
                <div class="campaign-card">
                    <div class="campaign-banner" style="background: linear-gradient(135deg, #${getRandomColor()}, #${getRandomColor()});">
                        <div class="campaign-banner-text">
                            <h2>${campaign.campaignName}</h2>
                            <p>${campaign.campaignType || 'Special Campaign'}</p>
                        </div>
                    </div>
                    <div class="campaign-body">
                        <div class="campaign-meta">
                            <div class="meta-item">
                                <span class="meta-icon">üìÖ</span>
                                <span>${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-icon">üìä</span>
                                <span>Status: ${campaign.status}</span>
                            </div>
                            ${campaign.budget ? `
                                <div class="meta-item">
                                    <span class="meta-icon">üí∞</span>
                                    <span>Budget: ‚Ç±${campaign.budget.toLocaleString()}</span>
                                </div>
                            ` : ''}
                        </div>
                        <p class="campaign-description">${campaign.description || 'Check out this amazing campaign and discover exclusive offers!'}</p>
                        <div class="campaign-cta">
                            <a href="/CustomerPortal/Products" class="cta-btn cta-primary">üõçÔ∏è Shop Campaign</a>
                            <button class="cta-btn cta-secondary" onclick="shareCampaign('${campaign.campaignName}')">üì§ Share</button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderEmpty() {
        document.getElementById('promotionsGrid').innerHTML = `
            <div class="empty-state" style="grid-column: 1/-1;">
                <div class="empty-state-icon">üè∑Ô∏è</div>
                <h3>No promotions available</h3>
                <p>Check back later for amazing deals!</p>
            </div>
        `;
        document.getElementById('campaignsContainer').innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üì£</div>
                <h3>No campaigns at the moment</h3>
                <p>Stay tuned for upcoming events!</p>
            </div>
        `;
    }

    function copyCode(code) {
        navigator.clipboard.writeText(code).then(() => {
            showToast('‚úì Code copied to clipboard!', '#10b981');
        }).catch(() => {
            showToast('Failed to copy code', '#ef4444');
        });
    }

    function shareCampaign(name) {
        if (navigator.share) {
            navigator.share({
                title: `CompuGear - ${name}`,
                text: `Check out this amazing campaign at CompuGear!`,
                url: window.location.href
            });
        } else {
            copyToClipboard(window.location.href);
            showToast('‚úì Link copied to clipboard!', '#10b981');
        }
    }

    function getRandomColor() {
        const colors = ['008080', '20b2aa', '10b981', '3b82f6', '8b5cf6', 'f59e0b', 'ef4444', 'ec4899'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function showToast(message, color) {
        const toast = document.createElement('div');
        toast.innerHTML = `<div style="position: fixed; bottom: 20px; right: 20px; background: ${color}; color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 9999;">${message}</div>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2500);
    }
</script>
}
