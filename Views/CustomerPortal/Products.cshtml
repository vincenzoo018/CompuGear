@{
    ViewData["Title"] = "Browse Products";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 style="font-weight: 700; color: #1f2937; margin-bottom: 5px;">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#008080" stroke-width="2" style="margin-right: 10px; vertical-align: middle;">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
            Computer Accessories
        </h2>
        <p style="color: #6b7280; margin: 0;">Browse our wide selection of quality computer accessories</p>
    </div>
    <div class="d-flex gap-2">
        <select class="form-select" style="width: auto; border-radius: 10px;">
            <option>Sort by: Featured</option>
            <option>Price: Low to High</option>
            <option>Price: High to Low</option>
            <option>Newest First</option>
            <option>Best Sellers</option>
        </select>
    </div>
</div>

<div class="row">
    <!-- Filters Sidebar -->
    <div class="col-lg-3 mb-4">
        <div class="portal-card">
            <h6 style="font-weight: 600; color: #1f2937; margin-bottom: 20px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#008080" stroke-width="2" style="margin-right: 8px; vertical-align: middle;">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                </svg>
                Filters
            </h6>

            <!-- Categories -->
            <div class="filter-section mb-4">
                <h6 style="font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 12px;">Categories</h6>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat1" checked style="border-color: #008080;">
                    <label class="form-check-label" for="cat1" style="color: #4b5563;">All Products</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat2">
                    <label class="form-check-label" for="cat2" style="color: #4b5563;">‚å®Ô∏è Keyboards</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat3">
                    <label class="form-check-label" for="cat3" style="color: #4b5563;">üñ±Ô∏è Mice & Mousepads</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat4">
                    <label class="form-check-label" for="cat4" style="color: #4b5563;">üéß Headsets & Audio</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat5">
                    <label class="form-check-label" for="cat5" style="color: #4b5563;">üñ•Ô∏è Monitors</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat6">
                    <label class="form-check-label" for="cat6" style="color: #4b5563;">üíæ Storage Devices</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat7">
                    <label class="form-check-label" for="cat7" style="color: #4b5563;">üîå Cables & Adapters</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="cat8">
                    <label class="form-check-label" for="cat8" style="color: #4b5563;">üéÆ Gaming Gear</label>
                </div>
            </div>

            <!-- Price Range -->
            <div class="filter-section mb-4">
                <h6 style="font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 12px;">Price Range</h6>
                <div class="d-flex gap-2 mb-3">
                    <input type="number" class="form-control" placeholder="Min" style="border-radius: 8px;">
                    <span style="line-height: 38px;">-</span>
                    <input type="number" class="form-control" placeholder="Max" style="border-radius: 8px;">
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="priceRange" id="price1">
                    <label class="form-check-label" for="price1" style="color: #4b5563;">Under ‚Ç±1,000</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="priceRange" id="price2">
                    <label class="form-check-label" for="price2" style="color: #4b5563;">‚Ç±1,000 - ‚Ç±5,000</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="priceRange" id="price3">
                    <label class="form-check-label" for="price3" style="color: #4b5563;">‚Ç±5,000 - ‚Ç±10,000</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="priceRange" id="price4">
                    <label class="form-check-label" for="price4" style="color: #4b5563;">‚Ç±10,000 - ‚Ç±50,000</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" name="priceRange" id="price5">
                    <label class="form-check-label" for="price5" style="color: #4b5563;">Above ‚Ç±50,000</label>
                </div>
            </div>

            <!-- Brands -->
            <div class="filter-section mb-4">
                <h6 style="font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 12px;">Brands</h6>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand1">
                    <label class="form-check-label" for="brand1" style="color: #4b5563;">Razer</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand2">
                    <label class="form-check-label" for="brand2" style="color: #4b5563;">Logitech</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand3">
                    <label class="form-check-label" for="brand3" style="color: #4b5563;">Corsair</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand4">
                    <label class="form-check-label" for="brand4" style="color: #4b5563;">Samsung</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand5">
                    <label class="form-check-label" for="brand5" style="color: #4b5563;">HyperX</label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="brand6">
                    <label class="form-check-label" for="brand6" style="color: #4b5563;">SteelSeries</label>
                </div>
            </div>

            <!-- On Sale -->
            <div class="filter-section">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="onSale" style="width: 3em; height: 1.5em;">
                    <label class="form-check-label" for="onSale" style="color: #374151; font-weight: 500; padding-top: 3px;">On Sale Only</label>
                </div>
            </div>

            <button class="btn w-100 mt-4" style="background: linear-gradient(135deg, #008080, #006666); color: white; border-radius: 10px; padding: 12px;">
                Apply Filters
            </button>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="col-lg-9">
        <!-- Promo Banner -->
        <div class="promo-banner mb-4" style="padding: 25px 30px;">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 style="margin-bottom: 5px;">üî• Gaming Week Sale - Up to 30% OFF!</h4>
                    <p style="margin-bottom: 0; opacity: 0.9; font-size: 0.95rem;">Get amazing deals on gaming peripherals. Limited time offer!</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/CustomerPortal/Promotions" class="btn-shop" style="padding: 10px 25px; font-size: 0.9rem;">Shop Now</a>
                </div>
            </div>
        </div>

        <!-- Results Info -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span style="color: #6b7280;" id="resultsInfo">Loading products...</span>
            <div class="btn-group">
                <button class="btn btn-sm" style="background: #008080; color: white; border-radius: 8px 0 0 8px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                </button>
                <button class="btn btn-sm btn-outline-secondary" style="border-radius: 0 8px 8px 0;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="18" height="4"/><rect x="3" y="10" width="18" height="4"/><rect x="3" y="17" width="18" height="4"/></svg>
                </button>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="row g-4" id="productsGrid">
            <!-- Products will be loaded dynamically -->
            <div class="col-12 text-center py-5" id="productsLoading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">Loading products...</p>
            </div>
        </div>

        <!-- Pagination -->
        <nav class="mt-4">
            <ul class="pagination justify-content-center" style="gap: 5px;">
                <li class="page-item disabled">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: #f3f4f6;">Previous</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: linear-gradient(135deg, #008080, #006666);">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: #f3f4f6; color: #374151;">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: #f3f4f6; color: #374151;">3</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: #f3f4f6; color: #374151;">4</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#" style="border-radius: 10px; border: none; background: #f3f4f6; color: #374151;">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="cartToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header" style="background: linear-gradient(135deg, #10b981, #34d399); color: white;">
            <strong class="me-auto">‚úì Added to Cart</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="cartToastBody">
            Product has been added to your cart.
        </div>
    </div>
</div>

@section Scripts {
<script>
    let allProducts = [];
    let currentPage = 1;
    const productsPerPage = 9;
    let currentCategory = '';
    let searchQuery = '';

    document.addEventListener('DOMContentLoaded', function() {
        loadProducts();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Search functionality
        const searchInput = document.querySelector('.input-group input');
        if (searchInput) {
            searchInput.addEventListener('input', function(e) {
                searchQuery = e.target.value.toLowerCase();
                currentPage = 1;
                renderProducts();
            });
        }

        // Category filter
        const categoryLinks = document.querySelectorAll('.quick-link');
        categoryLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                categoryLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                currentCategory = this.textContent.trim() === 'All Products' ? '' : this.textContent.trim();
                currentPage = 1;
                renderProducts();
            });
        });
    }

    async function loadProducts() {
        try {
            const response = await fetch('/api/products');
            if (response.ok) {
                allProducts = await response.json();
                renderProducts();
            } else {
                showEmptyState('Failed to load products');
            }
        } catch (error) {
            console.error('Error loading products:', error);
            showEmptyState('Error loading products');
        }
    }

    function renderProducts() {
        const grid = document.getElementById('productsGrid');
        const loading = document.getElementById('productsLoading');
        if (loading) loading.remove();

        // Filter products
        let filtered = allProducts.filter(p => {
            const matchesSearch = !searchQuery || 
                p.productName.toLowerCase().includes(searchQuery) ||
                (p.shortDescription && p.shortDescription.toLowerCase().includes(searchQuery));
            const matchesCategory = !currentCategory || 
                (p.categoryName && p.categoryName.toLowerCase() === currentCategory.toLowerCase());
            return matchesSearch && matchesCategory;
        });

        // Update results info
        const resultsInfo = document.getElementById('resultsInfo');
        if (resultsInfo) {
            const start = filtered.length > 0 ? ((currentPage - 1) * productsPerPage) + 1 : 0;
            const end = Math.min(currentPage * productsPerPage, filtered.length);
            resultsInfo.innerHTML = `Showing <strong>${start}-${end}</strong> of <strong>${filtered.length}</strong> products`;
        }

        if (filtered.length === 0) {
            grid.innerHTML = `
                <div class="col-12 text-center py-5">
                    <div style="font-size: 4rem; opacity: 0.5;">üì¶</div>
                    <h5 class="text-muted mt-3">No products found</h5>
                    <p class="text-muted">Try adjusting your search or filter criteria</p>
                </div>
            `;
            renderPagination(0);
            return;
        }

        // Pagination
        const totalPages = Math.ceil(filtered.length / productsPerPage);
        const start = (currentPage - 1) * productsPerPage;
        const paged = filtered.slice(start, start + productsPerPage);

        grid.innerHTML = paged.map(product => {
            const imageHtml = product.mainImageUrl 
                ? `<img src="${product.mainImageUrl}" alt="${product.productName}" class="product-img" onerror="this.parentElement.innerHTML='<div class=\\'product-image-placeholder\\'><svg width=\\'48\\' height=\\'48\\' viewBox=\\'0 0 24 24\\' fill=\\'none\\' stroke=\\'currentColor\\' stroke-width=\\'1.5\\'><rect x=\\'3\\' y=\\'3\\' width=\\'18\\' height=\\'18\\' rx=\\'2\\'/><circle cx=\\'8.5\\' cy=\\'8.5\\' r=\\'1.5\\'/><path d=\\'m21 15-5-5L5 21\\'/></svg></div>'">`
                : `<div class="product-image-placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="m21 15-5-5L5 21"/>
                    </svg>
                </div>`;

            const badge = product.stockQuantity <= 5 && product.stockQuantity > 0 
                ? '<span class="sale-badge">LOW STOCK</span>' 
                : product.stockQuantity === 0 
                    ? '<span class="sale-badge" style="background: #dc3545;">OUT OF STOCK</span>' 
                    : product.isOnSale 
                        ? '<span class="sale-badge">SALE</span>'
                        : product.isFeatured 
                            ? '<span class="sale-badge" style="background: #f59e0b;">FEATURED</span>'
                            : '';

            const price = product.sellingPrice || product.costPrice || 0;
            const comparePrice = product.compareAtPrice && product.compareAtPrice > price 
                ? `<span class="original-price">‚Ç±${parseFloat(product.compareAtPrice).toLocaleString('en-PH')}</span>` 
                : '';

            return `
                <div class="col-md-4">
                    <div class="product-card">
                        <div class="product-image">
                            ${badge}
                            ${imageHtml}
                        </div>
                        <div class="product-info">
                            <div class="product-category">${product.categoryName || 'Uncategorized'}</div>
                            <div class="product-name">${product.productName}</div>
                            <div style="color: #6b7280; font-size: 0.8rem; margin-bottom: 8px;">${product.shortDescription || ''}</div>
                            <div class="product-price">
                                <span class="current-price">‚Ç±${parseFloat(price).toLocaleString('en-PH')}</span>
                                ${comparePrice}
                            </div>
                            <button class="btn-add-cart" onclick="addToCart(${product.productId}, '${product.productName.replace(/'/g, "\\'")}', ${price})" ${product.stockQuantity === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 5px;">
                                    <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                                </svg>
                                ${product.stockQuantity === 0 ? 'Out of Stock' : 'Add to Cart'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
        const paginationContainer = document.querySelector('.pagination');
        if (!paginationContainer || totalPages <= 1) {
            if (paginationContainer) paginationContainer.innerHTML = '';
            return;
        }

        let html = `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;" style="border-radius: 10px; border: none; background: #f3f4f6;">Previous</a>
            </li>
        `;

        for (let i = 1; i <= totalPages; i++) {
            html += `
                <li class="page-item ${currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${i}); return false;" style="border-radius: 10px; border: none; ${currentPage === i ? 'background: linear-gradient(135deg, #008080, #006666);' : 'background: #f3f4f6; color: #374151;'}">${i}</a>
                </li>
            `;
        }

        html += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;" style="border-radius: 10px; border: none; background: #f3f4f6; color: #374151;">Next</a>
            </li>
        `;

        paginationContainer.innerHTML = html;
    }

    function changePage(page) {
        currentPage = page;
        renderProducts();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showEmptyState(message) {
        const grid = document.getElementById('productsGrid');
        grid.innerHTML = `
            <div class="col-12 text-center py-5">
                <div style="font-size: 4rem; opacity: 0.5;">‚ö†Ô∏è</div>
                <h5 class="text-muted mt-3">${message}</h5>
            </div>
        `;
    }

    function addToCart(productId, productName, price) {
        document.getElementById('cartToastBody').textContent = productName + ' (‚Ç±' + price.toLocaleString('en-PH') + ') has been added to your cart.';
        var toast = new bootstrap.Toast(document.getElementById('cartToast'));
        toast.show();
        
        // TODO: Implement actual cart functionality via API
        console.log('Added to cart:', { productId, productName, price });
    }
</script>
}
