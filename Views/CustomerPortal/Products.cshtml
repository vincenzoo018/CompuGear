@{
    ViewData["Title"] = "Products";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<style>
    .products-page { padding: 30px 0; background: #f8f9fa; min-height: 100vh; }
    
    .page-header {
        background: linear-gradient(135deg, #008080 0%, #20b2aa 100%);
        color: white;
        padding: 40px;
        border-radius: 20px;
        margin-bottom: 30px;
        text-align: center;
    }
    
    .page-header h1 { font-weight: 800; margin-bottom: 10px; font-size: 2.2rem; }
    .page-header p { opacity: 0.9; margin: 0; }
    
    .search-container {
        display: flex;
        gap: 15px;
        max-width: 600px;
        margin: 25px auto 0;
    }
    
    .search-container input {
        flex: 1;
        padding: 15px 25px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
    }
    
    .search-container input:focus { outline: none; }
    
    .search-btn {
        padding: 15px 30px;
        background: white;
        color: #008080;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .search-btn:hover { transform: scale(1.05); }
    
    .content-wrapper { display: flex; gap: 30px; }
    
    .filters-sidebar {
        width: 280px;
        flex-shrink: 0;
    }
    
    .filter-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
    
    .filter-title {
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 20px;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .filter-group { margin-bottom: 20px; }
    .filter-label { font-weight: 600; color: #374151; margin-bottom: 10px; display: block; }
    
    .filter-select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.95rem;
        background: white;
        cursor: pointer;
    }
    
    .filter-select:focus { border-color: #008080; outline: none; }
    
    .price-range {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .price-input {
        flex: 1;
        padding: 10px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.9rem;
    }
    
    .price-input:focus { border-color: #008080; outline: none; }
    
    .filter-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        cursor: pointer;
    }
    
    .filter-checkbox input { width: 18px; height: 18px; accent-color: #008080; }
    
    .apply-filters-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #008080, #006666);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .apply-filters-btn:hover { transform: translateY(-2px); }
    
    .reset-btn {
        width: 100%;
        padding: 12px;
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-weight: 500;
        cursor: pointer;
        margin-top: 10px;
    }
    
    .products-main { flex: 1; }
    
    .products-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .results-count { color: #6b7280; }
    
    .sort-dropdown {
        padding: 10px 20px;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        background: white;
        cursor: pointer;
    }
    
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
    }
    
    .product-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        transition: all 0.3s;
    }
    
    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.15);
    }
    
    .product-image {
        height: 200px;
        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 5rem;
        position: relative;
    }
    
    .product-badges {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        gap: 8px;
    }
    
    .badge-sale {
        background: #ff6b35;
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .badge-new {
        background: #10b981;
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .wishlist-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 40px;
        height: 40px;
        background: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }
    
    .wishlist-btn:hover { transform: scale(1.1); }
    
    .product-body { padding: 25px; }
    .product-category { color: #008080; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }
    .product-name { font-weight: 700; color: #1f2937; margin: 8px 0; font-size: 1.1rem; }
    .product-brand { color: #6b7280; font-size: 0.85rem; margin-bottom: 15px; }
    
    .product-pricing { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
    .current-price { font-size: 1.3rem; font-weight: 800; color: #008080; }
    .original-price { color: #9ca3af; text-decoration: line-through; font-size: 0.95rem; }
    .discount-tag { background: #fef2f2; color: #ef4444; padding: 3px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    
    .stock-status { font-size: 0.85rem; margin-bottom: 15px; }
    .in-stock { color: #10b981; }
    .low-stock { color: #f59e0b; }
    .out-of-stock { color: #ef4444; }
    
    .add-to-cart-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #008080, #006666);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    
    .add-to-cart-btn:hover { background: linear-gradient(135deg, #006666, #004d4d); }
    .add-to-cart-btn:disabled { background: #9ca3af; cursor: not-allowed; }
    
    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
    }
    
    .page-btn {
        padding: 12px 18px;
        border: 2px solid #e5e7eb;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .page-btn:hover, .page-btn.active {
        background: #008080;
        color: white;
        border-color: #008080;
    }
    
    .loading-spinner {
        text-align: center;
        padding: 60px;
        color: #6b7280;
    }
    
    @@media (max-width: 992px) {
        .content-wrapper { flex-direction: column; }
        .filters-sidebar { width: 100%; }
    }
</style>

<div class="products-page">
    <div class="container">
        <div class="page-header">
            <h1>üõçÔ∏è Browse Our Products</h1>
            <p>Find the best computer accessories for your needs</p>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search products...">
                <button class="search-btn" onclick="searchProducts()">üîç Search</button>
            </div>
        </div>
        
        <div class="content-wrapper">
            <div class="filters-sidebar">
                <div class="filter-card">
                    <div class="filter-title">üéØ Filters</div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select class="filter-select" id="categoryFilter">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Brand</label>
                        <select class="filter-select" id="brandFilter">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Price Range</label>
                        <div class="price-range">
                            <input type="number" class="price-input" id="minPrice" placeholder="Min">
                            <span>-</span>
                            <input type="number" class="price-input" id="maxPrice" placeholder="Max">
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label class="filter-label">Availability</label>
                        <label class="filter-checkbox">
                            <input type="checkbox" id="inStockOnly">
                            <span>In Stock Only</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" id="onSaleOnly">
                            <span>On Sale</span>
                        </label>
                    </div>
                    
                    <button class="apply-filters-btn" onclick="applyFilters()">Apply Filters</button>
                    <button class="reset-btn" onclick="resetFilters()">Reset Filters</button>
                </div>
            </div>
            
            <div class="products-main">
                <div class="products-header">
                    <span class="results-count" id="resultsCount">Loading products...</span>
                    <select class="sort-dropdown" id="sortDropdown" onchange="applyFilters()">
                        <option value="name">Sort by Name</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="newest">Newest First</option>
                    </select>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <div class="loading-spinner">Loading products...</div>
                </div>
                
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    let currentPage = 1;
    let totalPages = 1;
    const pageSize = 12;
    const productIcons = ['üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üéß', 'üíæ', 'üéÆ', 'üì±', 'üîå', 'üíª', 'üñ®Ô∏è'];

    document.addEventListener('DOMContentLoaded', function() {
        loadCategories();
        loadBrands();
        loadProducts();
        
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchProducts();
        });
    });

    async function loadCategories() {
        try {
            const response = await fetch('/CustomerPortal/GetCategories');
            const result = await response.json();
            if (result.success) {
                const select = document.getElementById('categoryFilter');
                result.data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.categoryId}">${cat.categoryName}</option>`;
                });
            }
        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    async function loadBrands() {
        try {
            const response = await fetch('/CustomerPortal/GetBrands');
            const result = await response.json();
            if (result.success) {
                const select = document.getElementById('brandFilter');
                result.data.forEach(brand => {
                    select.innerHTML += `<option value="${brand}">${brand}</option>`;
                });
            }
        } catch (error) {
            console.error('Error loading brands:', error);
        }
    }

    async function loadProducts(page = 1) {
        currentPage = page;
        const search = document.getElementById('searchInput').value;
        const category = document.getElementById('categoryFilter').value;
        const brand = document.getElementById('brandFilter').value;
        const minPrice = document.getElementById('minPrice').value;
        const maxPrice = document.getElementById('maxPrice').value;
        const inStock = document.getElementById('inStockOnly').checked;
        const onSale = document.getElementById('onSaleOnly').checked;
        const sort = document.getElementById('sortDropdown').value;

        const params = new URLSearchParams({
            page: page,
            pageSize: pageSize,
            search: search,
            categoryId: category,
            brand: brand,
            minPrice: minPrice,
            maxPrice: maxPrice,
            inStockOnly: inStock,
            onSale: onSale,
            sortBy: sort
        });

        try {
            document.getElementById('productsGrid').innerHTML = '<div class="loading-spinner">üîÑ Loading products...</div>';
            
            const response = await fetch(`/CustomerPortal/GetProducts?${params}`);
            const result = await response.json();
            
            if (result.success) {
                renderProducts(result.data);
                document.getElementById('resultsCount').textContent = `Showing ${result.data.length} of ${result.totalCount} products`;
                totalPages = Math.ceil(result.totalCount / pageSize);
                renderPagination();
            } else {
                document.getElementById('productsGrid').innerHTML = '<div class="loading-spinner">No products found</div>';
            }
        } catch (error) {
            console.error('Error loading products:', error);
            document.getElementById('productsGrid').innerHTML = '<div class="loading-spinner">Error loading products</div>';
        }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productsGrid');
        
        if (!products || products.length === 0) {
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üîç</div>
                    <h3 style="color: #1f2937; margin-bottom: 10px;">No products found</h3>
                    <p style="color: #6b7280;">Try adjusting your filters or search terms</p>
                </div>
            `;
            return;
        }

        grid.innerHTML = products.map((product, index) => {
            const stockStatus = product.stockQuantity > 10 ? 'in-stock' : 
                              product.stockQuantity > 0 ? 'low-stock' : 'out-of-stock';
            const stockText = product.stockQuantity > 10 ? '‚úì In Stock' : 
                            product.stockQuantity > 0 ? `‚ö† Only ${product.stockQuantity} left` : '‚úó Out of Stock';
            
            const hasDiscount = product.compareAtPrice && product.compareAtPrice > product.sellingPrice;
            const discountPercent = hasDiscount ? Math.round((1 - product.sellingPrice / product.compareAtPrice) * 100) : 0;

            return `
                <div class="product-card">
                    <div class="product-image">
                        ${productIcons[index % productIcons.length]}
                        <div class="product-badges">
                            ${hasDiscount ? '<span class="badge-sale">SALE</span>' : ''}
                            ${product.isNew ? '<span class="badge-new">NEW</span>' : ''}
                        </div>
                        <button class="wishlist-btn" onclick="toggleWishlist(${product.productId})">‚ô°</button>
                    </div>
                    <div class="product-body">
                        <div class="product-category">${product.categoryName || 'Accessories'}</div>
                        <div class="product-name">${product.productName}</div>
                        <div class="product-brand">${product.brand || 'Generic'}</div>
                        <div class="product-pricing">
                            <span class="current-price">‚Ç±${product.sellingPrice.toLocaleString('en-PH', {minimumFractionDigits: 2})}</span>
                            ${hasDiscount ? `
                                <span class="original-price">‚Ç±${product.compareAtPrice.toLocaleString()}</span>
                                <span class="discount-tag">-${discountPercent}%</span>
                            ` : ''}
                        </div>
                        <div class="stock-status ${stockStatus}">${stockText}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.productId}, '${product.productName.replace(/'/g, "\\'")}', ${product.sellingPrice}, '${product.sku || ''}')" ${product.stockQuantity <= 0 ? 'disabled' : ''}>
                            üõí Add to Cart
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderPagination() {
        const pagination = document.getElementById('pagination');
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let html = '';
        
        if (currentPage > 1) {
            html += `<button class="page-btn" onclick="loadProducts(${currentPage - 1})">‚Üê Prev</button>`;
        }
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="loadProducts(${i})">${i}</button>`;
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                html += '<span style="padding: 10px;">...</span>';
            }
        }
        
        if (currentPage < totalPages) {
            html += `<button class="page-btn" onclick="loadProducts(${currentPage + 1})">Next ‚Üí</button>`;
        }
        
        pagination.innerHTML = html;
    }

    function searchProducts() {
        loadProducts(1);
    }

    function applyFilters() {
        loadProducts(1);
    }

    function resetFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('categoryFilter').value = '';
        document.getElementById('brandFilter').value = '';
        document.getElementById('minPrice').value = '';
        document.getElementById('maxPrice').value = '';
        document.getElementById('inStockOnly').checked = false;
        document.getElementById('onSaleOnly').checked = false;
        document.getElementById('sortDropdown').value = 'name';
        loadProducts(1);
    }

    function addToCart(productId, productName, price, sku) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existingIndex = cart.findIndex(item => item.productId === productId);
        
        if (existingIndex > -1) {
            cart[existingIndex].quantity += 1;
        } else {
            cart.push({ productId, name: productName, price, sku, quantity: 1 });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();
        showToast('‚úì Added to cart!', '#10b981');
    }

    function toggleWishlist(productId) {
        showToast('‚ô° Added to wishlist!', '#008080');
    }

    function updateCartBadge() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        const badge = document.querySelector('.cart-count');
        if (badge) badge.textContent = count;
    }

    function showToast(message, color) {
        const toast = document.createElement('div');
        toast.innerHTML = `<div style="position: fixed; bottom: 20px; right: 20px; background: ${color}; color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 9999;">${message}</div>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2500);
    }
</script>
}
