@{
    ViewData["Title"] = "Browse Products";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<style>
    .products-page { min-height: 100vh; }

    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
        color: white;
        padding: 32px 40px;
        border-radius: 16px;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: 'üõçÔ∏è';
        position: absolute;
        right: 40px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 5rem;
        opacity: 0.15;
    }

    .page-header h1 { font-size: 1.8rem; font-weight: 800; margin-bottom: 8px; }
    .page-header p { opacity: 0.9; margin: 0; }

    /* Content Layout */
    .content-wrapper {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 24px;
    }

    /* Sidebar Filters */
    .filters-sidebar {
        position: sticky;
        top: 100px;
        height: fit-content;
    }

    .filter-card {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 20px;
        margin-bottom: 16px;
    }

    .filter-title {
        font-weight: 700;
        color: var(--foreground);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-group { margin-bottom: 16px; }
    .filter-group:last-child { margin-bottom: 0; }

    .filter-label {
        font-weight: 600;
        color: var(--foreground);
        font-size: 0.85rem;
        margin-bottom: 8px;
        display: block;
    }

    .filter-select {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.9rem;
        background: var(--card);
        cursor: pointer;
        transition: border-color 0.2s;
    }

    .filter-select:focus { border-color: var(--primary); outline: none; }

    /* Price Range Slider */
    .price-range-container { padding: 8px 0; }

    .price-inputs {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
    }

    .price-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.85rem;
    }

    .price-input:focus { border-color: var(--primary); outline: none; }

    .price-slider {
        width: 100%;
        height: 6px;
        -webkit-appearance: none;
        background: linear-gradient(to right, var(--primary) 0%, var(--primary) 50%, var(--border) 50%, var(--border) 100%);
        border-radius: 3px;
        outline: none;
    }

    .price-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background: var(--primary);
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .filter-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .filter-checkbox input {
        width: 18px;
        height: 18px;
        accent-color: var(--primary);
        cursor: pointer;
    }

    .btn-apply {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 8px;
    }

    .btn-apply:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,128,128,0.3); }

    .btn-reset {
        width: 100%;
        padding: 10px;
        background: transparent;
        color: var(--muted-foreground);
        border: 1px solid var(--border);
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-reset:hover { background: var(--muted); }

    /* Products Main */
    .products-main { min-width: 0; }

    .products-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 12px;
    }

    .results-count { color: var(--muted-foreground); font-size: 0.9rem; }
    .results-count strong { color: var(--foreground); }

    .toolbar-actions { display: flex; align-items: center; gap: 12px; }

    .view-toggle {
        display: flex;
        background: var(--muted);
        border-radius: 8px;
        padding: 4px;
    }

    .view-btn {
        padding: 8px 12px;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 6px;
        color: var(--muted-foreground);
        transition: all 0.2s;
    }

    .view-btn.active { background: var(--card); color: var(--foreground); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

    .sort-dropdown {
        padding: 8px 14px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: var(--card);
        font-size: 0.9rem;
        cursor: pointer;
    }

    /* Product Grid */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
    }

    .products-grid.list-view {
        grid-template-columns: 1fr;
    }

    .products-grid.list-view .product-card {
        display: grid;
        grid-template-columns: 200px 1fr;
    }

    .products-grid.list-view .product-image { height: 160px; }
    .products-grid.list-view .product-body { display: flex; flex-direction: column; justify-content: center; }

    .product-card {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        overflow: hidden;
        transition: all 0.2s;
    }

    .product-card:hover {
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        transform: translateY(-4px);
    }

    .product-image {
        height: 180px;
        background: linear-gradient(135deg, var(--muted) 0%, var(--border) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
        position: relative;
    }

    .product-badges {
        position: absolute;
        top: 12px;
        left: 12px;
        display: flex;
        gap: 6px;
    }

    .badge-sale {
        background: var(--accent);
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .badge-new {
        background: var(--success);
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .wishlist-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 36px;
        height: 36px;
        background: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.2s;
    }

    .wishlist-btn:hover { transform: scale(1.1); }
    .wishlist-btn.active { background: #FEE2E2; }

    .product-body { padding: 16px; }
    .product-category { color: var(--primary); font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-bottom: 4px; }
    .product-name { font-weight: 600; color: var(--foreground); font-size: 0.95rem; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .product-brand { color: var(--muted-foreground); font-size: 0.8rem; margin-bottom: 8px; }

    .product-rating {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 10px;
    }

    .stars { display: flex; gap: 2px; }
    .star { color: #FCD34D; font-size: 0.85rem; }
    .star.empty { color: var(--border); }
    .rating-count { color: var(--muted-foreground); font-size: 0.75rem; }

    .product-pricing { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .current-price { font-size: 1.2rem; font-weight: 700; color: var(--accent); }
    .original-price { font-size: 0.85rem; color: var(--muted-foreground); text-decoration: line-through; }
    .discount-tag { background: var(--error-light); color: var(--error-fg); padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }

    .stock-status { font-size: 0.8rem; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
    .stock-status.in-stock { color: var(--success-fg); }
    .stock-status.low-stock { color: var(--warning-fg); }
    .stock-status.out-of-stock { color: var(--error-fg); }

    .btn-add-cart {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .btn-add-cart:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,128,128,0.3); }
    .btn-add-cart:disabled { background: var(--muted); color: var(--muted-foreground); cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-add-cart.added { background: var(--success); }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 32px;
    }

    .page-btn {
        padding: 10px 16px;
        border: 1px solid var(--border);
        background: var(--card);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
    }

    .page-btn:hover { border-color: var(--primary); }
    .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; color: var(--muted-foreground); }
    .empty-state-icon { font-size: 4rem; margin-bottom: 16px; opacity: 0.5; }
    .empty-state-text { font-size: 1.1rem; margin-bottom: 8px; }

    /* Mobile Filter Toggle */
    .mobile-filter-toggle {
        display: none;
        width: 100%;
        padding: 12px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 16px;
        cursor: pointer;
        font-weight: 600;
    }

    /* Responsive */
    @@media (max-width: 992px) {
        .content-wrapper { grid-template-columns: 1fr; }

        .filters-sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 300px;
            height: 100vh;
            background: var(--background);
            z-index: 1100;
            padding: 20px;
            overflow-y: auto;
            transition: left 0.3s ease;
        }

        .filters-sidebar.open { left: 0; }

        .filter-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1050;
        }

        .filter-overlay.show { display: block; }

        .mobile-filter-toggle { display: flex; align-items: center; justify-content: center; gap: 8px; }

        .close-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .close-filters button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
    }

    @@media (max-width: 768px) {
        .page-header { padding: 24px; }
        .page-header h1 { font-size: 1.4rem; }
        .products-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .product-image { height: 140px; font-size: 2.5rem; }
        .product-body { padding: 12px; }
        .product-name { font-size: 0.85rem; }
        .current-price { font-size: 1rem; }
    }

    @@media (max-width: 576px) {
        .page-header::before { display: none; }
        .toolbar-actions { width: 100%; justify-content: space-between; }
    }
</style>

<div class="products-page">
    <!-- Page Header -->
    <div class="page-header animate-fade-in">
        <h1>üõçÔ∏è Browse Products</h1>
        <p>Discover the best computer accessories for your setup</p>
    </div>

    <!-- Mobile Filter Toggle -->
    <button class="mobile-filter-toggle" onclick="toggleFilters()">
        üéØ Filter & Sort
    </button>

    <!-- Filter Overlay -->
    <div class="filter-overlay" id="filterOverlay" onclick="toggleFilters()"></div>

    <div class="content-wrapper">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar" id="filtersSidebar">
            <div class="close-filters d-lg-none">
                <span class="filter-title">üéØ Filters</span>
                <button onclick="toggleFilters()">‚úï</button>
            </div>

            <div class="filter-card">
                <div class="filter-title d-none d-lg-flex">üéØ Filters</div>

                <div class="filter-group">
                    <label class="filter-label">Category</label>
                    <select class="filter-select" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Brand</label>
                    <select class="filter-select" id="brandFilter">
                        <option value="">All Brands</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Price Range</label>
                    <div class="price-range-container">
                        <div class="price-inputs">
                            <input type="number" class="price-input" id="minPrice" placeholder="‚Ç± Min">
                            <span>‚Äî</span>
                            <input type="number" class="price-input" id="maxPrice" placeholder="‚Ç± Max">
                        </div>
                        <input type="range" class="price-slider" id="priceSlider" min="0" max="50000" value="25000">
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Availability</label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="inStockOnly">
                        <span>In Stock Only</span>
                    </label>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="onSaleOnly">
                        <span>On Sale</span>
                    </label>
                </div>

                <button class="btn-apply" onclick="applyFilters()">Apply Filters</button>
                <button class="btn-reset" onclick="resetFilters()">Reset All</button>
            </div>
        </aside>

        <!-- Products Main -->
        <main class="products-main">
            <div class="products-toolbar">
                <div class="results-count">
                    Showing <strong id="resultsCount">0</strong> products
                </div>
                <div class="toolbar-actions">
                    <div class="view-toggle">
                        <button class="view-btn active" id="gridViewBtn" onclick="setView('grid')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
                            </svg>
                        </button>
                        <button class="view-btn" id="listViewBtn" onclick="setView('list')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/>
                                <line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/>
                                <line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <select class="sort-dropdown" id="sortDropdown" onchange="applyFilters()">
                        <option value="featured">Featured</option>
                        <option value="name">Name: A-Z</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                        <option value="newest">Newest First</option>
                    </select>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon">üîÑ</div>
                    <p class="empty-state-text">Loading products...</p>
                </div>
            </div>

            <div class="pagination-container" id="pagination"></div>
        </main>
    </div>
</div>

@section Scripts {
<script>
    let currentPage = 1;
    let totalPages = 1;
    let currentView = 'grid';
    const pageSize = 12;
    const productIcons = ['üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üéß', 'üíæ', 'üéÆ', 'üì±', 'üîå', 'üíª', 'üñ®Ô∏è', 'üîä', 'üì∑'];

    document.addEventListener('DOMContentLoaded', function() {
        loadCategories();
        loadBrands();
        loadProducts();

        // Check URL params for search
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('search');
        if (searchQuery) {
            // Trigger search with the query
        }
    });

    function toggleFilters() {
        document.getElementById('filtersSidebar').classList.toggle('open');
        document.getElementById('filterOverlay').classList.toggle('show');
    }

    function setView(view) {
        currentView = view;
        const grid = document.getElementById('productsGrid');
        const gridBtn = document.getElementById('gridViewBtn');
        const listBtn = document.getElementById('listViewBtn');

        if (view === 'list') {
            grid.classList.add('list-view');
            gridBtn.classList.remove('active');
            listBtn.classList.add('active');
        } else {
            grid.classList.remove('list-view');
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
        }
    }

    async function loadCategories() {
        try {
            const response = await fetch('/CustomerPortal/GetCategories');
            const result = await response.json();
            if (result.success) {
                const select = document.getElementById('categoryFilter');
                result.data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.categoryId}">${cat.categoryName}</option>`;
                });
            }
        } catch (error) { console.error('Error loading categories:', error); }
    }

    async function loadBrands() {
        try {
            const response = await fetch('/CustomerPortal/GetBrands');
            const result = await response.json();
            if (result.success) {
                const select = document.getElementById('brandFilter');
                result.data.forEach(brand => {
                    select.innerHTML += `<option value="${brand}">${brand}</option>`;
                });
            }
        } catch (error) { console.error('Error loading brands:', error); }
    }

    async function loadProducts(page = 1) {
        currentPage = page;
        const category = document.getElementById('categoryFilter').value;
        const brand = document.getElementById('brandFilter').value;
        const onSale = document.getElementById('onSaleOnly').checked;
        const sort = document.getElementById('sortDropdown').value;

        const params = new URLSearchParams({
            page: page,
            pageSize: pageSize,
            categoryId: category,
            brand: brand,
            onSale: onSale,
            sort: sort
        });

        try {
            const response = await fetch(`/CustomerPortal/GetProducts?${params}`);
            const result = await response.json();

            if (result.success) {
                document.getElementById('resultsCount').textContent = result.pagination.total;
                totalPages = result.pagination.totalPages;
                renderProducts(result.data);
                renderPagination();
            }
        } catch (error) {
            console.error('Error loading products:', error);
            document.getElementById('productsGrid').innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon">‚ùå</div>
                    <p class="empty-state-text">Failed to load products</p>
                </div>`;
        }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productsGrid');
        const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');

        if (!products || products.length === 0) {
            grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon">üì¶</div>
                    <p class="empty-state-text">No products found</p>
                    <p style="font-size: 0.9rem;">Try adjusting your filters</p>
                </div>`;
            return;
        }

        grid.innerHTML = products.map((product, index) => {
            const inWishlist = wishlist.includes(product.productId) || wishlist.some(w => w && w.productId === product.productId);
            const rating = Math.floor(3 + Math.random() * 2);
            const reviewCount = Math.floor(10 + Math.random() * 200);
            const stockStatus = product.stockQuantity > 10 ? 'in-stock' : product.stockQuantity > 0 ? 'low-stock' : 'out-of-stock';
            const stockText = product.stockQuantity > 10 ? '‚úì In Stock' : product.stockQuantity > 0 ? `‚ö† Only ${product.stockQuantity} left` : '‚úï Out of Stock';

            return `
                <div class="product-card animate-fade-in" style="animation-delay: ${index * 0.05}s">
                    <div class="product-image">
                        ${productIcons[index % productIcons.length]}
                        <div class="product-badges">
                            ${product.isOnSale ? '<span class="badge-sale">SALE</span>' : ''}
                            ${product.isFeatured ? '<span class="badge-new">Featured</span>' : ''}
                        </div>
                        <button class="wishlist-btn ${inWishlist ? 'active' : ''}" onclick="toggleWishlist(event, ${product.productId}, '${product.productName.replace(/'/g, "\\'")}', ${product.sellingPrice})">
                            ${inWishlist ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    <div class="product-body">
                        <div class="product-category">${product.categoryName || 'Accessories'}</div>
                        <div class="product-name" title="${product.productName}">${product.productName}</div>
                        <div class="product-brand">${product.brandName || 'Generic'}</div>
                        <div class="product-rating">
                            <div class="stars">
                                ${'<span class="star">‚òÖ</span>'.repeat(rating)}${'<span class="star empty">‚òÖ</span>'.repeat(5 - rating)}
                            </div>
                            <span class="rating-count">(${reviewCount})</span>
                        </div>
                        <div class="product-pricing">
                            <span class="current-price">‚Ç±${product.sellingPrice.toLocaleString('en-PH', { minimumFractionDigits: 2 })}</span>
                            ${product.compareAtPrice ? `
                                <span class="original-price">‚Ç±${product.compareAtPrice.toLocaleString()}</span>
                                <span class="discount-tag">-${product.discountPercent}%</span>
                            ` : ''}
                        </div>
                        <div class="stock-status ${stockStatus}">${stockText}</div>
                        <button class="btn-add-cart" id="addBtn-${product.productId}" 
                                onclick="addToCart(${product.productId}, '${product.productName.replace(/'/g, "\\'")}', ${product.sellingPrice}, '${product.sku || ''}')"
                                ${product.stockQuantity === 0 ? 'disabled' : ''}>
                            ${product.stockQuantity === 0 ? '‚úï Out of Stock' : 'üõí Add to Cart'}
                        </button>
                    </div>
                </div>`;
        }).join('');
    }

    function renderPagination() {
        const container = document.getElementById('pagination');
        if (totalPages <= 1) { container.innerHTML = ''; return; }

        let html = `<button class="page-btn" onclick="loadProducts(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Prev</button>`;

        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="loadProducts(${i})">${i}</button>`;
            } else if (i === currentPage - 2 || i === currentPage + 2) {
                html += `<span style="padding: 0 8px;">...</span>`;
            }
        }

        html += `<button class="page-btn" onclick="loadProducts(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>`;
        container.innerHTML = html;
    }

    function applyFilters() {
        toggleFilters();
        loadProducts(1);
    }

    function resetFilters() {
        document.getElementById('categoryFilter').value = '';
        document.getElementById('brandFilter').value = '';
        document.getElementById('minPrice').value = '';
        document.getElementById('maxPrice').value = '';
        document.getElementById('inStockOnly').checked = false;
        document.getElementById('onSaleOnly').checked = false;
        document.getElementById('sortDropdown').value = 'featured';
        loadProducts(1);
    }

    function toggleWishlist(event, productId, productName, price) {
        event.stopPropagation();
        let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
        // Store as plain productId integers for consistency
        const index = wishlist.indexOf(productId);
        // Also check old object format
        const objIndex = wishlist.findIndex(w => w && w.productId === productId);
        const btn = event.currentTarget;

        if (index > -1 || objIndex > -1) {
            if (index > -1) wishlist.splice(index, 1);
            else wishlist.splice(objIndex, 1);
            btn.classList.remove('active');
            btn.innerHTML = 'ü§ç';
            showToast('Removed from wishlist', 'info');
        } else {
            wishlist.push(productId);
            btn.classList.add('active');
            btn.innerHTML = '‚ù§Ô∏è';
            showToast('Added to wishlist!', 'success');
        }
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
    }

    function addToCart(productId, productName, price, sku) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existingIndex = cart.findIndex(item => item.productId === productId);

        if (existingIndex > -1) {
            cart[existingIndex].quantity += 1;
        } else {
            cart.push({ productId, name: productName, price, sku: sku || '', quantity: 1 });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();

        const btn = document.getElementById(`addBtn-${productId}`);
        if (btn) {
            btn.classList.add('added');
            btn.innerHTML = '‚úì Added!';
            setTimeout(() => { btn.classList.remove('added'); btn.innerHTML = 'üõí Add to Cart'; }, 2000);
        }

        showToast('‚úì Added to cart!', 'success');
    }
</script>
}
