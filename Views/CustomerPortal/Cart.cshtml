@{
    ViewData["Title"] = "Shopping Cart";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<style>
    .cart-page { min-height: 100vh; }

    /* Page Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .page-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--foreground);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .item-count {
        background: var(--primary);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
    }

    .btn-continue {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
    }

    .btn-continue:hover { text-decoration: underline; }

    /* Layout */
    .cart-layout {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 32px;
    }

    /* Cart Items Section */
    .cart-items {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        overflow: hidden;
    }

    .cart-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border);
        display: grid;
        grid-template-columns: 3fr 1fr 1fr 1fr auto;
        gap: 20px;
        font-weight: 600;
        color: var(--muted-foreground);
        font-size: 0.85rem;
        text-transform: uppercase;
    }

    .cart-list { padding: 0; }

    .cart-item {
        display: grid;
        grid-template-columns: 3fr 1fr 1fr 1fr auto;
        gap: 20px;
        padding: 24px;
        align-items: center;
        border-bottom: 1px solid var(--border);
        transition: all 0.3s ease;
    }

    .cart-item:last-child { border-bottom: none; }

    .cart-item.removing {
        animation: slideOut 0.3s ease forwards;
    }

    @@keyframes slideOut {
        0% { opacity: 1; transform: translateX(0); }
        100% { opacity: 0; transform: translateX(-50px); height: 0; padding: 0; }
    }

    .item-info {
        display: flex;
        gap: 16px;
        align-items: center;
    }

    .item-image {
        width: 80px;
        height: 80px;
        background: var(--muted);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        flex-shrink: 0;
    }

    .item-details {}
    .item-name {
        font-weight: 600;
        color: var(--foreground);
        margin-bottom: 4px;
    }

    .item-sku {
        font-size: 0.8rem;
        color: var(--muted-foreground);
    }

    .item-stock {
        font-size: 0.8rem;
        color: var(--success);
        display: flex;
        align-items: center;
        gap: 4px;
        margin-top: 4px;
    }

    .item-price {
        font-weight: 600;
        color: var(--foreground);
    }

    /* Quantity Controls */
    .qty-control {
        display: flex;
        align-items: center;
        gap: 0;
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
    }

    .qty-btn {
        width: 36px;
        height: 36px;
        background: var(--muted);
        border: none;
        cursor: pointer;
        font-size: 1.2rem;
        color: var(--foreground);
        transition: all 0.2s;
    }

    .qty-btn:hover:not(:disabled) { background: var(--border); }
    .qty-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .qty-value {
        width: 48px;
        text-align: center;
        font-weight: 600;
        font-size: 1rem;
        padding: 8px 0;
        background: var(--card);
    }

    .item-total {
        font-weight: 700;
        color: var(--primary);
        font-size: 1.1rem;
    }

    .btn-remove {
        width: 36px;
        height: 36px;
        background: none;
        border: none;
        color: var(--muted-foreground);
        cursor: pointer;
        font-size: 1.2rem;
        border-radius: 50%;
        transition: all 0.2s;
    }

    .btn-remove:hover {
        background: var(--error-light);
        color: var(--error);
    }

    /* Sidebar */
    .cart-sidebar { display: flex; flex-direction: column; gap: 20px; }

    /* Coupon Section */
    .coupon-section {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 24px;
    }

    .coupon-title {
        font-weight: 600;
        color: var(--foreground);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .coupon-input-group {
        display: flex;
        gap: 8px;
    }

    .coupon-input {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.95rem;
        text-transform: uppercase;
    }

    .coupon-input:focus { outline: none; border-color: var(--primary); }

    .btn-apply {
        padding: 12px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-apply:hover { background: var(--primary-hover); }

    .coupon-applied {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--success-light);
        padding: 12px 16px;
        border-radius: 8px;
        margin-top: 12px;
    }

    .coupon-code {
        font-weight: 600;
        color: var(--success-fg);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .coupon-remove {
        background: none;
        border: none;
        color: var(--success-fg);
        cursor: pointer;
        font-size: 1.2rem;
    }

    /* Order Summary */
    .order-summary {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        padding: 24px;
    }

    .summary-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--foreground);
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border);
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 0.95rem;
    }

    .summary-label { color: var(--muted-foreground); }
    .summary-value { font-weight: 500; color: var(--foreground); }

    .summary-row.discount .summary-value { color: var(--success); }

    .shipping-indicator {
        background: var(--info-light);
        color: var(--info-fg);
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        margin: 16px 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .shipping-progress {
        flex: 1;
        height: 6px;
        background: rgba(255,255,255,0.3);
        border-radius: 10px;
        overflow: hidden;
    }

    .shipping-progress-fill {
        height: 100%;
        background: var(--info);
        border-radius: 10px;
        transition: width 0.3s;
    }

    .summary-total {
        display: flex;
        justify-content: space-between;
        padding: 16px 0;
        margin-top: 16px;
        border-top: 2px solid var(--border);
        font-size: 1.2rem;
    }

    .total-label { font-weight: 700; color: var(--foreground); }
    .total-value { font-weight: 800; color: var(--primary); }

    .btn-checkout {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-checkout:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,128,128,0.3);
    }

    /* Trust Badges */
    .trust-badges {
        display: flex;
        justify-content: center;
        gap: 24px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
        margin-top: 20px;
    }

    .trust-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--muted-foreground);
    }

    .trust-icon { font-size: 1.5rem; }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
    }

    .empty-icon { font-size: 5rem; margin-bottom: 24px; opacity: 0.5; }
    .empty-title { font-size: 1.5rem; font-weight: 700; color: var(--foreground); margin-bottom: 12px; }
    .empty-text { color: var(--muted-foreground); margin-bottom: 24px; }

    .btn-shop {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 14px 28px;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .btn-shop:hover { color: white; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,128,128,0.3); }

    /* Responsive */
    @@media (max-width: 1024px) {
        .cart-layout { grid-template-columns: 1fr; }
        .cart-sidebar { order: -1; }
    }

    @@media (max-width: 768px) {
        .cart-header { display: none; }
        .cart-item {
            grid-template-columns: 1fr;
            gap: 16px;
            padding: 20px;
        }
        .item-info { flex-direction: column; text-align: center; }
        .item-image { width: 100px; height: 100px; margin: 0 auto; }
        .qty-control { justify-content: center; }
        .item-total { text-align: center; font-size: 1.3rem; }
        .btn-remove { position: absolute; top: 12px; right: 12px; }
        .cart-item { position: relative; }
        .page-header { flex-direction: column; align-items: flex-start; gap: 12px; }
    }

    @@media (max-width: 576px) {
        .page-title { font-size: 1.5rem; }
        .trust-badges { gap: 16px; }
        .trust-badge { font-size: 0.65rem; }
    }
</style>

<div class="cart-page">
    <!-- Page Header -->
    <div class="page-header animate-fade-in">
        <h1 class="page-title">
            üõí Shopping Cart
            <span class="item-count" id="headerItemCount">0</span>
        </h1>
        <a href="/CustomerPortal/Products" class="btn-continue">
            ‚Üê Continue Shopping
        </a>
    </div>

    <div id="cartContent">
        <!-- Content loaded dynamically -->
    </div>
</div>

@section Scripts {
<script>
    const productIcons = ['üñ•Ô∏è', '‚å®Ô∏è', 'üñ±Ô∏è', 'üéß', 'üíæ', 'üéÆ', 'üì±', 'üîå', 'üíª', 'üñ®Ô∏è'];
    let cartItems = [];
    let appliedCoupon = null;
    const freeShippingThreshold = 2000;

    document.addEventListener('DOMContentLoaded', loadCart);

    function loadCart() {
        cartItems = JSON.parse(localStorage.getItem('cart') || '[]');

        if (cartItems.length === 0) {
            showEmptyState();
        } else {
            renderCart();
        }
    }

    function renderCart() {
        const container = document.getElementById('cartContent');
        document.getElementById('headerItemCount').textContent = cartItems.length;

        const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const discount = appliedCoupon ? (appliedCoupon.type === 'percent' ? subtotal * (appliedCoupon.value / 100) : appliedCoupon.value) : 0;
        const shipping = subtotal >= freeShippingThreshold ? 0 : 150;
        const total = subtotal - discount + shipping;
        const shippingProgress = Math.min((subtotal / freeShippingThreshold) * 100, 100);
        const amountToFreeShipping = Math.max(freeShippingThreshold - subtotal, 0);

        container.innerHTML = `
            <div class="cart-layout">
                <!-- Cart Items -->
                <div class="cart-items animate-fade-in">
                    <div class="cart-header">
                        <span>Product</span>
                        <span>Price</span>
                        <span>Quantity</span>
                        <span>Total</span>
                        <span></span>
                    </div>
                    <div class="cart-list" id="cartList">
                        ${cartItems.map((item, index) => `
                            <div class="cart-item" id="item-${item.productId}">
                                <div class="item-info">
                                    <div class="item-image">${productIcons[index % productIcons.length]}</div>
                                    <div class="item-details">
                                        <div class="item-name">${item.name}</div>
                                        ${item.sku ? `<div class="item-sku">SKU: ${item.sku}</div>` : ''}
                                        <div class="item-stock">‚úì In Stock</div>
                                    </div>
                                </div>
                                <div class="item-price">‚Ç±${item.price.toLocaleString('en-PH', { minimumFractionDigits: 2 })}</div>
                                <div class="qty-control">
                                    <button class="qty-btn" onclick="updateQuantity(${item.productId}, -1)" ${item.quantity <= 1 ? 'disabled' : ''}>‚àí</button>
                                    <div class="qty-value">${item.quantity}</div>
                                    <button class="qty-btn" onclick="updateQuantity(${item.productId}, 1)">+</button>
                                </div>
                                <div class="item-total">‚Ç±${(item.price * item.quantity).toLocaleString('en-PH', { minimumFractionDigits: 2 })}</div>
                                <button class="btn-remove" onclick="removeItem(${item.productId})" title="Remove item">üóëÔ∏è</button>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="cart-sidebar">
                    <!-- Coupon Section -->
                    <div class="coupon-section animate-fade-in" style="animation-delay: 0.1s">
                        <div class="coupon-title">üè∑Ô∏è Promo Code</div>
                        <div class="coupon-input-group">
                            <input type="text" class="coupon-input" id="couponInput" placeholder="Enter code" maxlength="20">
                            <button class="btn-apply" onclick="applyCoupon()">Apply</button>
                        </div>
                        ${appliedCoupon ? `
                            <div class="coupon-applied">
                                <span class="coupon-code">‚úì ${appliedCoupon.code} applied</span>
                                <button class="coupon-remove" onclick="removeCoupon()">√ó</button>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary animate-fade-in" style="animation-delay: 0.15s">
                        <h3 class="summary-title">Order Summary</h3>
                        <div class="summary-row">
                            <span class="summary-label">Subtotal (${cartItems.length} items)</span>
                            <span class="summary-value">‚Ç±${subtotal.toLocaleString('en-PH', { minimumFractionDigits: 2 })}</span>
                        </div>
                        ${appliedCoupon ? `
                            <div class="summary-row discount">
                                <span class="summary-label">Discount (${appliedCoupon.code})</span>
                                <span class="summary-value">-‚Ç±${discount.toLocaleString('en-PH', { minimumFractionDigits: 2 })}</span>
                            </div>
                        ` : ''}
                        <div class="summary-row">
                            <span class="summary-label">Shipping</span>
                            <span class="summary-value">${shipping === 0 ? '<span style="color: var(--success)">FREE</span>' : '‚Ç±' + shipping.toLocaleString()}</span>
                        </div>

                        ${amountToFreeShipping > 0 ? `
                            <div class="shipping-indicator">
                                <span>üöö</span>
                                <div style="flex: 1">
                                    <div style="margin-bottom: 4px">Add ‚Ç±${amountToFreeShipping.toLocaleString()} for FREE shipping!</div>
                                    <div class="shipping-progress">
                                        <div class="shipping-progress-fill" style="width: ${shippingProgress}%"></div>
                                    </div>
                                </div>
                            </div>
                        ` : `
                            <div class="shipping-indicator" style="background: var(--success-light); color: var(--success-fg)">
                                <span>üéâ</span>
                                <span>You've unlocked FREE shipping!</span>
                            </div>
                        `}

                        <div class="summary-total">
                            <span class="total-label">Total</span>
                            <span class="total-value">‚Ç±${total.toLocaleString('en-PH', { minimumFractionDigits: 2 })}</span>
                        </div>

                        <button class="btn-checkout" onclick="proceedToCheckout()">
                            üîí Proceed to Checkout
                        </button>

                        <div class="trust-badges">
                            <div class="trust-badge">
                                <span class="trust-icon">üîí</span>
                                <span>Secure Checkout</span>
                            </div>
                            <div class="trust-badge">
                                <span class="trust-icon">‚Ü©Ô∏è</span>
                                <span>30-Day Returns</span>
                            </div>
                            <div class="trust-badge">
                                <span class="trust-icon">üõ°Ô∏è</span>
                                <span>Buyer Protection</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function showEmptyState() {
        document.getElementById('headerItemCount').textContent = '0';
        document.getElementById('cartContent').innerHTML = `
            <div class="empty-state animate-fade-in">
                <div class="empty-icon">üõí</div>
                <h2 class="empty-title">Your cart is empty</h2>
                <p class="empty-text">Looks like you haven't added anything yet!</p>
                <a href="/CustomerPortal/Products" class="btn-shop">
                    üõçÔ∏è Start Shopping
                </a>
            </div>
        `;
    }

    function updateQuantity(productId, change) {
        const item = cartItems.find(i => i.productId === productId);
        if (!item) return;

        item.quantity += change;
        if (item.quantity < 1) item.quantity = 1;

        localStorage.setItem('cart', JSON.stringify(cartItems));
        updateCartBadge();
        renderCart();
    }

    function removeItem(productId) {
        const itemElement = document.getElementById('item-' + productId);
        itemElement.classList.add('removing');

        setTimeout(() => {
            cartItems = cartItems.filter(i => i.productId !== productId);
            localStorage.setItem('cart', JSON.stringify(cartItems));
            updateCartBadge();

            if (cartItems.length === 0) {
                showEmptyState();
            } else {
                renderCart();
            }

            showToast('Item removed from cart', 'info');
        }, 300);
    }

    function applyCoupon() {
        const code = document.getElementById('couponInput').value.trim().toUpperCase();
        if (!code) {
            showToast('Please enter a promo code', 'warning');
            return;
        }

        // Mock coupon validation
        const validCoupons = {
            'SAVE10': { code: 'SAVE10', type: 'percent', value: 10 },
            'SAVE20': { code: 'SAVE20', type: 'percent', value: 20 },
            'FLAT500': { code: 'FLAT500', type: 'fixed', value: 500 },
            'WELCOME': { code: 'WELCOME', type: 'percent', value: 15 }
        };

        if (validCoupons[code]) {
            appliedCoupon = validCoupons[code];
            showToast('‚úì Coupon applied successfully!', 'success');
            renderCart();
        } else {
            showToast('Invalid promo code', 'error');
        }
    }

    function removeCoupon() {
        appliedCoupon = null;
        showToast('Coupon removed', 'info');
        renderCart();
    }

    function proceedToCheckout() {
        if (cartItems.length === 0) {
            showToast('Your cart is empty', 'warning');
            return;
        }
        window.location.href = '/CustomerPortal/Checkout';
    }
</script>
}
